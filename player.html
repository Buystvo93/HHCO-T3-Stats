<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Player Profile</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f9;
      margin: 0;
      padding: 0;
      color: #333;
    }

    /* üîπ Navbar styling */
    .navbar {
      background: #0078d7;
      color: white;
      padding: 12px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    .navbar-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .navbar img {
      width: 35px;
      height: 35px;
    }

    .navbar h1 {
      font-size: 1.5rem;
      margin: 0;
    }

    .back-btn {
      background: white;
      color: #0078d7;
      text-decoration: none;
      font-weight: bold;
      padding: 8px 12px;
      border-radius: 6px;
      transition: 0.2s;
    }

    .back-btn:hover {
      background: #005bb5;
      color: white;
    }

    /* üîπ Player Card */
    .player-card {
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      text-align: center;
    }

    .avatar-container {
      display: flex;
      justify-content: center;
      margin-bottom: 15px;
    }

    .player-avatar {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      border: 4px solid #0078d7;
      object-fit: cover;
    }

    h2 {
      margin-top: 20px;
      font-size: 1.6rem;
      color: #0078d7;
    }

    /* üîπ Stats Table */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }

    th {
      background: #0078d7;
      color: white;
    }

    tr:nth-child(even) {
      background: #f9f9f9;
    }

    .totals-row {
      background: #005bb5;
      color: white;
      font-weight: bold;
    }

    .cup-year {
      background: gold !important;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <!-- üîπ Navbar -->
  <div class="navbar">
    <div class="navbar-left">
      <img src="images/logo.png" alt="HHCO Logo">
      <h1>HHCO</h1>
    </div>
    <a href="index.html" class="back-btn">‚Üê Back to Home</a>
  </div>

  <!-- üîπ Player Info -->
  <div class="player-card">
    <div class="avatar-container">
      <img id="player-avatar" class="player-avatar" alt="Player Avatar">
    </div>
    <h1 id="name"></h1>

    <h2>Skater Stats</h2>
    <table id="statsTable">
      <thead></thead>
      <tbody></tbody>
    </table>

    <h2>Goalie Stats</h2>
    <table id="goalieStatsTable">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    async function loadPlayer() {
      const params = new URLSearchParams(window.location.search);
      const playerId = params.get("id");

      try {
        const res = await fetch("players.json?nocache=" + Date.now());
        const players = await res.json();

        const player = players.find(p => p.id === playerId);
        if (!player) {
          document.body.innerHTML = "<h2>Player not found</h2>";
          return;
        }

        document.getElementById("name").textContent = player.name;

        const avatarImg = document.getElementById("player-avatar");
        avatarImg.onerror = () => {
          avatarImg.src = "images/default-avatar.png";
        };
        avatarImg.src = player.avatar;

        // Skater stats
        if (player.seasons && player.seasons.length > 0) {
          buildTable(player.seasons, "statsTable");
        }

        // Goalie stats
        if (player.goalieSeasons && player.goalieSeasons.length > 0) {
          buildTable(player.goalieSeasons, "goalieStatsTable");
        }

      } catch (err) {
        console.error("Error loading player data:", err);
        document.body.innerHTML = "<h2>Error loading data</h2>";
      }
    }

    function buildTable(seasons, tableId) {
      const tableHead = document.querySelector(`#${tableId} thead`);
      const tableBody = document.querySelector(`#${tableId} tbody`);

      tableHead.innerHTML = "";
      tableBody.innerHTML = "";

      const headers = Object.keys(seasons[0]);
      const headerRow = document.createElement("tr");
      headers.forEach(h => {
        if (h !== "cup") {
          const th = document.createElement("th");
          th.textContent = h.toUpperCase();
          headerRow.appendChild(th);
        }
      });
      tableHead.appendChild(headerRow);

      const totals = {};
      headers.forEach(h => (totals[h] = h === "year" ? "" : 0));

      seasons.forEach(season => {
        const row = document.createElement("tr");
        if (season.cup === true) row.classList.add("cup-year");

        headers.forEach(h => {
          if (h !== "cup") {
            const td = document.createElement("td");
            td.textContent = season[h];
            row.appendChild(td);
            if (h !== "year") totals[h] += Number(season[h]) || 0;
          }
        });

        tableBody.appendChild(row);
      });

      const totalsRow = document.createElement("tr");
      totalsRow.classList.add("totals-row");
      headers.forEach(h => {
        if (h !== "cup") {
          const td = document.createElement("td");
          td.innerHTML = h === "year" ? "<b>Career Totals</b>" : `<b>${totals[h]}</b>`;
          totalsRow.appendChild(td);
        }
      });
      tableBody.appendChild(totalsRow);
    }

    loadPlayer();
  </script>
</body>
</html>
