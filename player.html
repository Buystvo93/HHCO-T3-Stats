<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Player Profile</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="player-card">

    <div class="player-header">
     <img id="player-avatar" class="player-avatar" alt="Player Avatar">
     <h1 id="player-name"></h1>
    </div>

    
    <h1 id="name"></h1>

    <h2>Season by Season Stats</h2>
    <table id="statsTable">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>
  
  <a href="index.html" class="back-btn">‚Üê Back to Home</a>
  <script>

    
    async function loadPlayer() {
      const params = new URLSearchParams(window.location.search);
      const playerId = params.get("id"); // e.g. ?id=1

      

      try {
        const res = await fetch("players.json?nocache=" + Date.now());
        const players = await res.json();

        const player = players.find(p => p.id === playerId);
        if (!player) {
          document.body.innerHTML = "<h2>Player not found</h2>";
          return;
        }

        document.getElementById("name").textContent = player.name;

         const playerId = player.id; // assuming your JSON has "id" as Roblox ID
         document.getElementById("player-avatar").src =
        `https://www.roblox.com/headshot-thumbnail/image?userId=${playerId}&width=420&height=420&format=png`;

        const tableHead = document.querySelector("#statsTable thead");
        const tableBody = document.querySelector("#statsTable tbody");

        if (!player.seasons || player.seasons.length === 0) {
          tableBody.innerHTML = "<tr><td colspan='10'>No stats available</td></tr>";
          return;
        }

        // Use keys from the first season to make dynamic headers
        const headers = Object.keys(player.seasons[0]);

        // Build table header
        const headerRow = document.createElement("tr");
        headers.forEach(h => {
          const th = document.createElement("th");
          th.textContent = h.toUpperCase();
          headerRow.appendChild(th);
        });
        tableHead.appendChild(headerRow);

        // Totals tracker
        const totals = {};
        headers.forEach(h => totals[h] = (h === "year" ? "" : 0));

        // Fill rows
        player.seasons.forEach(season => {
          const row = document.createElement("tr");
          headers.forEach(h => {
            const td = document.createElement("td");
            td.textContent = season[h];
            row.appendChild(td);

            if (h !== "year") {
              totals[h] += Number(season[h]) || 0;
            }
          });
          tableBody.appendChild(row);
        });

        // Totals row
        const totalsRow = document.createElement("tr");
        totalsRow.classList.add("totals-row");
        headers.forEach(h => {
          const td = document.createElement("td");
          if (h === "year") {
            td.innerHTML = "<b>Career Totals</b>";
          } else {
            td.innerHTML = `<b>${totals[h]}</b>`;
          }
          totalsRow.appendChild(td);
        });
        tableBody.appendChild(totalsRow);

      } catch (err) {
        console.error("Error loading player data:", err);
        document.body.innerHTML = "<h2>Error loading data</h2>";
      }
    }
    loadPlayer();
  </script>
</body>
</html>
